<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FoodHub</title>
    <meta name="description" content="FoodHub">
    <meta name="author" content="FoodHub">
    <meta name="keywords" content="FoodHub">
    <link rel="icon" href="logo.png" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.0/flowbite.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css"
          integrity="sha512-mD70nAW2ThLsWH0zif8JPbfraZ8hbCtjQ+5RU1m4+ztZq6/MymyZeB55pWsi4YAX+73yvcaJyk61mzfYMvtm9w=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js" integrity="sha512-8pbzenDolL1l5OPSsoURCx9TEdMFTaeFipASVrMYKhuYtly+k3tcsQYliOEKTmuB1t7yuzAiVo+yd7SJz+ijFQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900">
<nav class="bg-white border-gray-200 dark:bg-gray-900">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
        <a href="./" class="flex items-center">
            <img src="logo.png" class="h-8 mr-3" alt="FoodHub Logo"/>
            <span class="self-center text-xl font-bold text-gray-800 dark:text-white md:text-2xl md:font-black"
            >FoodHub</span>
        </a>
        <div class="flex items-center md:order-2">
            <button type="button"
                    class="flex mr-3 text-sm bg-gray-800 rounded-full md:mr-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600"
                    id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown"
                    data-dropdown-placement="bottom">
                <span class="sr-only">Open user menu</span>
                <img class="w-8 h-8 rounded-full" alt="user photo" id="user-photo"
                     src="https://mdbcdn.b-cdn.net/img/new/avatars/1.webp"
                >
            </button>
            <!-- Dropdown menu -->
            <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600"
                 id="user-dropdown">
                <div class="px-4 py-3">
                    <span class="block text-sm text-gray-900 dark:text-white" id="user-name"></span>
                    <span class="block text-sm  text-gray-500 truncate dark:text-gray-400" id="user-email"></span>
                </div>
                <ul class="py-2" aria-labelledby="user-menu-button">
                    <li>
                        <a href="#"
                           class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white"
                           onclick="signOut();"
                        >Sign Out</a>
                    </li>
                </ul>
            </div>
            <button data-collapse-toggle="mobile-menu-2" type="button"
                    class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                    aria-controls="mobile-menu-2" aria-expanded="false">
                <span class="sr-only">Open main menu</span>
                <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                          d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                          clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="mobile-menu-2">
            <ul class="flex flex-col font-medium p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
                <li>
                    <a href="./"
                       class="block py-2 pl-3 pr-4 text-white bg-blue-700 rounded md:bg-transparent md:text-white md:p-0 md:dark:text-white"
                       aria-current="page">Home</a>
                </li>
                <li>
                    <a href="./preferences"
                       class="block py-2 pl-3 pr-4 text-blue-500 rounded hover:text-blue-500 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:text-blue-500 dark:hover:text-blue-500 md:dark:hover:bg-transparent dark:border-gray-700">Preferences</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<main>
    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-wrap">
            <ul class="flex flex-col w-full md:w-1/4 md:mr-8">
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-1" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(1)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-1" class="font-medium text-gray-900 dark:text-gray-300">
                                Nepali
                                <p id="helper-checkbox-text-1"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Nepal's cuisine is diverse, with influences from India, Tibet, and China. Dal bhat
                                    (rice and lentils) is the staple dish, served with vegetables, pickles, and
                                    sometimes meat. Momo, a type of dumpling, is also popular.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-2" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(2)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-2" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Thakali</div>
                                <p id="helper-checkbox-text-2"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Thakali cuisine comes from the Thak Khola valley of Nepal. It is known for its
                                    distinct taste and use of spices such as timur (Sichuan pepper) and jimbu (dried
                                    herb). Dal bhat, buckwheat pancakes, and grilled meat dishes are common in Thakali
                                    cuisine.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-3" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(3)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-3" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Newari</div>
                                <p id="helper-checkbox-text-3"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Newari cuisine comes from the Newar people of Nepal's Kathmandu Valley. It is known
                                    for its unique taste, fermented foods, and variety of dishes. Some popular dishes
                                    include chatamari (rice flour crepe), bara (lentil pancake), and choila (grilled
                                    meat).</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-4" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(4)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-4" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>American</div>
                                <p id="helper-checkbox-text-4"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    American cuisine varies greatly by region but is generally characterized by its use
                                    of meat, dairy, and wheat. Some iconic American dishes include hamburgers, hot dogs,
                                    macaroni and cheese, and apple pie.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-5" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(5)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-5" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Chinese</div>
                                <p id="helper-checkbox-text-5"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Chinese cuisine is known for its diverse flavors, textures, and cooking techniques.
                                    It includes various styles such as Cantonese, Sichuanese, and Shanghainese. Some
                                    popular dishes include dumplings, stir-fries, and hot pot.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-6" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(6)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-6" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Indian</div>
                                <p id="helper-checkbox-text-6"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Indian cuisine is diverse and varies greatly by region. It is characterized by its
                                    use of spices, herbs, and vegetables. Some popular dishes include biryani, naan,
                                    samosas, and curries.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-7" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(7)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-7" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Italian</div>
                                <p id="helper-checkbox-text-7"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Italian cuisine is known for its simplicity and fresh ingredients. It includes
                                    dishes such as pizza, pasta, risotto, and gelato. Italian cuisine also varies by
                                    region, with dishes such as Neapolitan pizza and Tuscan steak.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-8" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(8)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-8" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Japanese</div>
                                <p id="helper-checkbox-text-8"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Japanese cuisine is known for its emphasis on fresh ingredients and presentation. It
                                    includes dishes such as sushi, ramen, tempura, and teriyaki. Japanese cuisine also
                                    has a strong culture of tea and sake.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-9" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(9)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-9" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Mexican</div>
                                <p id="helper-checkbox-text-9"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Mexican cuisine is known for its bold flavors and use of spices such as chili,
                                    cumin, and oregano. It includes dishes such as tacos, enchiladas, guacamole, and
                                    mole sauce.</p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-10" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(10)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-10" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Thai</div>
                                <p id="helper-checkbox-text-10"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Thai cuisine is known for its balance of sweet, sour, salty, and spicy flavors. It
                                    includes dishes such as curries, stir-fries, and noodle dishes. Thai cuisine also
                                    includes the use of fresh herbs such as basil, cilantro, and lemongrass.
                                </p>
                            </label>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="flex p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600">
                        <div class="flex items-center h-5">
                            <input id="helper-checkbox-11" aria-describedby="helper-checkbox-text-2" type="checkbox"
                                   onclick="togglePreference(11)"
                                   value=""
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-700 dark:focus:ring-offset-gray-700 focus:ring-2 dark:bg-gray-600 dark:border-gray-500">
                        </div>
                        <div class="ml-2 text-sm">
                            <label for="helper-checkbox-11" class="font-medium text-gray-900 dark:text-gray-300">
                                <div>Vietnamese</div>
                                <p id="helper-checkbox-text-11"
                                   class="text-xs font-normal text-gray-500 dark:text-gray-300">
                                    Vietnamese cuisine is known for its use of fresh herbs, vegetables, and spices. It
                                    includes dishes such as pho (noodle soup), banh mi (baguette sandwich), and spring
                                    rolls. Vietnamese cuisine also has a strong culture of coffee and tea.</label>
                        </div>
                    </div>
                </li>
            </ul>

        </div>

    </div>
</main>
<script>
    const userToken = localStorage.getItem("userToken");
    if (!userToken) {
        // window.location.href = "./login";
    }
    const userDetail = "./api/users/getUser/" + userToken;
    fetch(userDetail)
        .then(response => response.json())
        .then(data => {
            if (data.status === "error") {
                window.location.href = "./login";
            }
            console.log(data.body);
            document.getElementById("user-name").innerText = data.body.name;
            document.getElementById("user-email").innerText = data.body.email;
            const md5Email = md5(data.body.email);
            document.getElementById("user-photo").src = "https://www.gravatar.com/avatar/" + md5Email + "?d=https://mdbcdn.b-cdn.net/img/new/avatars/1.webp";
            updatePreferenceUI(data.body);
        });
    window.addEventListener('DOMContentLoaded', (event) => {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.querySelector('html').classList.add('dark');
        }
    });
    document.addEventListener('contextmenu', event => event.preventDefault());
    document.onselectstart = function () {
        return false;
    };

    //sign out
    function signOut() {
        localStorage.removeItem("userToken");
        window.location.href = "./login";
    }

    function togglePreference(cuisine) {
        const userToken = localStorage.getItem("userToken") ? localStorage.getItem("userToken") : "";
        const userDetail = "./api/users/togglePreference/" + userToken + "/" + cuisine;
        updatePreference();

        async function updatePreference() {
            const response = await fetch(userDetail).catch(err => {
                const toast = document.createElement("div");
                toast.classList.add("bg-red-500", "text-white", "font-bold", "rounded", "px-4", "py-3", "absolute", "top-0", "right-0", "mt-4", "mr-4", "z-50");
                toast.setAttribute("role", "alert");
                toast.innerHTML = "Preference not updated";
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            });
            if (response.status !== 200) {
                const toast = document.createElement("div");
                toast.classList.add("bg-red-500", "text-white", "font-bold", "rounded", "px-4", "py-3", "absolute", "top-0", "right-0", "mt-4", "mr-4", "z-50");
                toast.setAttribute("role", "alert");
                toast.innerHTML = "Preference not updated";
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            } else {
                const toast = document.createElement("div");
                toast.classList.add("bg-green-500", "text-white", "font-bold", "rounded", "px-4", "py-3", "absolute", "top-0", "right-0", "mt-4", "mr-4", "z-50");
                toast.setAttribute("role", "alert");
                toast.innerHTML = "Preference updated";
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            updatePreferenceUI();
        }
    }
    function updatePreferenceUI(user) {
        if (user !== undefined) {
            const preferences = user.userPreference;
            for (let i = 0; i < preferences.length; i++) {
                document.getElementById("helper-checkbox-" + getPreferenceID(preferences[i])).checked = true;
            }
        } else {
            //get user preferences and update the UI
            const userPreference = "./api/users/getUser/" + userToken;
            fetch(userPreference)
                .then(response => response.json())
                .then(data => {
                    if (data.status === "error") {
                        window.location.href = "./login";
                    }
                    console.log(data.body);
                    const preferences = data.body.userPreference;
                    for (let i = 0; i < preferences.length; i++) {
                        document.getElementById("helper-checkbox-" + getPreferenceID(preferences[i])).checked = true;
                    }
                });
        }
    }

    function getPreferenceID(preferences) {
        switch (preferences) {
            case "NEPALI":
                return 1;
            case "THAKALI":
                return 2;
            case "NEWARI":
                return 3;
            case "AMERICAN":
                return 4;
            case "CHINESE":
                return 5;
            case "INDIAN":
                return 6;
            case "ITALIAN":
                return 7;
            case "JAPANESE":
                return 8;
            case "MEXICAN":
                return 9;
            case "THAI":
                return 10;
            case "VIETNAMESE":
                return 11;
        }
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.0/flowbite.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"
        integrity="sha512-Dqm3h1Y4qiHUjbhxTuBGQsza0Tfppn53SHlu/uj1f+RT+xfShfe7r6czRf5r2NmllO2aKx+tYJgoxboOkn1Scg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>
</html>